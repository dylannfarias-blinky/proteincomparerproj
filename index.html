<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Protein Bars & Smoothies Comparison</title>
  <link rel="stylesheet" href="styles.css">
  <link rel="icon" type="image/x-icon" href="images/favicon_io/favicon-32x32.png">
</head>
<body>
  <header>
    <h1>Protein Bars & Smoothies</h1>
    <nav>
      <ul>
        <li><a href="#compare">Compare</a></li>
        <li><a href="#bars">Bars</a></li>
        <li><a href="#smoothies">Smoothies</a></li>
        <li><a href="#guides">Guides</a></li>
        <li><a href="#about">About</a></li>
        <li><a href="#contact">Contact</a></li>
      </ul>
    </nav>
  </header>

  <main>
    <section id="hero">
      <h2>Find the best protein bar or smoothie for your lifestyle</h2>
      <input type="text" placeholder="Search products...">
    </section>

    <section id="compare">
      <h2>Comparison Tool</h2>
      <div class="comparison-tool">
        <label for="typeSelect">Compare:</label>
        <select id="typeSelect">
          <option value="bar-sm">Bar vs Smoothie</option>
          <option value="bar-bar">Bar vs Bar</option>
          <option value="sm-sm">Smoothie vs Smoothie</option>
        </select>

        <select id="firstSelect">
          <option value="">Select first product</option>
        </select>
        <select id="secondSelect">
          <option value="">Select second product</option>
        </select>

        <table>
          <tr><th>Nutrition</th><th>First</th><th>Second</th></tr>
          <tr><td>Calories</td><td id="firstCalories">–</td><td id="secondCalories">–</td></tr>
          <tr><td>Protein</td><td id="firstProtein">–</td><td id="secondProtein">–</td></tr>
          <tr><td>Sugar</td><td id="firstSugar">–</td><td id="secondSugar">–</td></tr>
          <tr><td>Fat</td><td id="firstFat">–</td><td id="secondFat">–</td></tr>
          <tr><td>Price</td><td id="firstPrice">–</td><td id="secondPrice">–</td></tr>
        </table>
      </div>
    </section>

    <!-- ✅ Added missing Bars section -->
    <section id="bars">
      <h2>Bars</h2>
      <div id="barsList" class="product-list">
        <div class="product-card">Sample Bar</div>
      </div>
    </section>

    <section id="smoothies">
      <h2>Smoothies</h2>
      <div id="smoothiesList" class="product-list">
        <div class="product-card">Sample Smoothie</div>
      </div>
    </section>

    <section id="guides">
      <h2>Guides</h2>
      <article>
        <h3>How to Choose a Protein Snack</h3>
        <p>Tips and nutrition breakdowns…</p>
      </article>
    </section>

    <section id="about">
      <h2>About</h2>
      <p>This site helps you compare protein bars and smoothies quickly and easily.</p>
    </section>

    <section id="contact">
      <h2>Contact</h2>
      <form>
        <input type="text" placeholder="Your Name">
        <input type="email" placeholder="Your Email">
        <textarea placeholder="Message"></textarea>
        <button type="submit">Send</button>
      </form>
    </section>
  </main>

  <footer>
    <p>&copy; <span id="year"></span> Dylan Farias</p>
  </footer>

  <script>
    document.getElementById("year").textContent = new Date().getFullYear();

    const SHEET_URL = "https://sheetdb.io/api/v1/9aa5ss3hdm7su";
    let bars = [];
    let smoothies = [];

    async function fetchData() {
      try {
        const res = await fetch(SHEET_URL);
        if (!res.ok) throw new Error("Bad response from server");
        const data = await res.json();

        bars = data.filter(row => row.type === "bar");
        smoothies = data.filter(row => row.type === "sm");

        renderLists();
        populateFirstSecondSelects();
      } catch (err) {
        console.error("Error fetching sheet:", err);
        alert("Could not load product data. Check SheetDB URL and CORS settings.");
      }
    }

    function renderLists() {
      const barsList = document.getElementById("barsList");
      const smoothiesList = document.getElementById("smoothiesList");

      if (barsList) {
        barsList.innerHTML = bars.length
          ? bars.map(b =>
              `<div class="product-card"><strong>${b.name || "Unnamed"}</strong><br>${b.brand || ""} - ${b.protein || 0}g protein</div>`
            ).join("")
          : "<p>No bars found.</p>";
      }

      if (smoothiesList) {
        smoothiesList.innerHTML = smoothies.length
          ? smoothies.map(s =>
              `<div class="product-card"><strong>${s.name || "Unnamed"}</strong><br>${s.brand || ""} - ${s.protein || 0}g protein</div>`
            ).join("")
          : "<p>No smoothies found.</p>";
      }
    }

    function populateFirstSecondSelects() {
      const typeSelect = document.getElementById("typeSelect");
      const firstSelect = document.getElementById("firstSelect");
      const secondSelect = document.getElementById("secondSelect");

      function updateOptions() {
        const type = typeSelect.value;
        let firstOptions = [];
        let secondOptions = [];

        if (type === "bar-sm") {
          firstOptions = bars;
          secondOptions = smoothies;
        } else if (type === "bar-bar") {
          firstOptions = secondOptions = bars;
        } else if (type === "sm-sm") {
          firstOptions = secondOptions = smoothies;
        }

        firstSelect.innerHTML = '<option value="">Select first product</option>' +
          firstOptions.map((p, i) => `<option value="${p._id || i}">${p.name || "Unnamed"} (${p.brand || ""})</option>`).join("");

        secondSelect.innerHTML = '<option value="">Select second product</option>' +
          secondOptions.map((p, i) => `<option value="${p._id || i}">${p.name || "Unnamed"} (${p.brand || ""})</option>`).join("");

        updateComparison();
      }

      typeSelect.addEventListener("change", updateOptions);
      firstSelect.addEventListener("change", updateComparison);
      secondSelect.addEventListener("change", updateComparison);

      updateOptions();
    }

    function updateComparison() {
      const firstId = document.getElementById("firstSelect").value;
      const secondId = document.getElementById("secondSelect").value;
      const type = document.getElementById("typeSelect").value;

      let firstArray = (type === "sm-sm") ? smoothies : bars;
      let secondArray = (type === "bar-sm") ? smoothies : ((type === "sm-sm") ? smoothies : bars);

      const first = firstArray.find((p, i) => (p._id || i).toString() === firstId);
      const second = secondArray.find((p, i) => (p._id || i).toString() === secondId);

      document.getElementById("firstCalories").textContent = first?.calories ?? "–";
      document.getElementById("firstProtein").textContent = first?.protein ? first.protein + "g" : "–";
      document.getElementById("firstSugar").textContent = first?.sugar ?? "–";
      document.getElementById("firstFat").textContent = first?.fat ?? "–";
      document.getElementById("firstPrice").textContent = first?.price ? "$" + first.price : "–";

      document.getElementById("secondCalories").textContent = second?.calories ?? "–";
      document.getElementById("secondProtein").textContent = second?.protein ? second.protein + "g" : "–";
      document.getElementById("secondSugar").textContent = second?.sugar ?? "–";
      document.getElementById("secondFat").textContent = second?.fat ?? "–";
      document.getElementById("secondPrice").textContent = second?.price ? "$" + second.price : "–";
    }

    fetchData();
  </script>
</body>
</html>
